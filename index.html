<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>üîê FetchBox</title>

<style>
:root{--accent:#58a6ff;--bg1:#161b22;--bg2:#010409;--text:#e6e6e6;--muted:#8b949e}
*{-webkit-tap-highlight-color:transparent;box-sizing:border-box}
html,body{
  height:100%;margin:0;overflow:hidden;touch-action:none;
  font-family:Inter,Roboto,"Helvetica Neue",sans-serif;
  background:radial-gradient(circle,var(--bg1),var(--bg2));
  color:var(--text);color-scheme:dark;
  -webkit-font-smoothing:antialiased
}
body{display:grid;place-content:center;text-align:center}

button{
  margin:8px;padding:12px 24px;font-size:15px;font-weight:600;
  color:#fff;background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.1);
  border-radius:12px;cursor:pointer;transition:.2s;
  outline:none
}
button:hover{background:rgba(255,255,255,.1);border-color:var(--accent);transform:translateY(-2px)}
button:active{transform:scale(.96)}
button:focus,button:focus-visible{outline:none}

.output-container{min-height:160px;margin-top:40px;display:flex;flex-direction:column;align-items:center}
#loading{color:var(--accent);font-style:italic;animation:pulse 1.5s infinite}
@keyframes pulse{50%{opacity:.5}}

#downloadLink{
  color:var(--accent);font-weight:700;text-decoration:none;
  border:1px solid var(--accent);padding:8px 16px;border-radius:8px
}
#downloadLink:hover{background:rgba(88,166,255,.1)}

#commitInfo{
  color:var(--muted);line-height:1.8;font-size:.85em;
  font-family:"JetBrains Mono","Roboto Mono",monospace
}
.hidden{display:none}
strong{color:#fff}
.err-msg{color:#ff7b72!important}
</style>

</head>
<body>
<header style="margin-bottom:30px">
  <h1 style="margin:0;font-size:32px;font-weight:800;letter-spacing:-1.5px">
    Fetch<span style="color:var(--accent)">Box</span>
  </h1>
  <p style="color:var(--muted);font-size:14px">Device attestation made easy</p>
</header>

<div id="actions">
  <button data-action="tricky">Tricky Addon</button>
  <button data-action="yurikey">Yurikey</button>
  <button data-action="integrity">Integrity Box</button>
  <button data-action="verify">View Commits</button>
</div>

<div class="output-container">
  <div id="loading" class="hidden">Accessing repository...</div>
  <a id="downloadLink" class="hidden"></a>
  <div id="commitInfo" class="hidden"></div>
</div>

<script>
const $=id=>document.getElementById(id),
[load,dl,info]=['loading','downloadLink','commitInfo'].map($),
ui=(l,d,i,e=0)=>{
  load.classList.toggle('hidden',!l);
  dl.classList.toggle('hidden',!d);
  info.classList.toggle('hidden',!i);
  info.classList.toggle('err-msg',e);
},
hex=h=>h.match(/../g).map(b=>String.fromCharCode(parseInt(b,16))).join(''),
rot=s=>s.replace(/[a-z]/gi,c=>String.fromCharCode(
  (c<='Z'?65:97)+(c.charCodeAt(0)-(c<='Z'?65:97)+13)%26)),
ago=ms=>{
  const t=[[60,'s'],[60,'m'],[24,'h']],u=['s','m','h','d'];
  let i=0,v=ms/1000;while(i<3&&v>=t[i][0])v/=t[i++][0];
  return Math.floor(v)+u[i]+' ago';
};

const decoders={
  tricky:h=>atob(hex(h)),
  yurikey:h=>atob(h),
  integrity:h=>{
    let d=h.trim();for(let i=0;i<10;i++)d=atob(d);
    return rot(hex(d));
  }
};

const files={
  tricky:{r:'KOWX712/Tricky-Addon-Update-Target-List',p:'.extra',n:'trickyaddon.xml',l:'Tricky Addon',
    u:'https://raw.githubusercontent.com/KOWX712/Tricky-Addon-Update-Target-List/refs/heads/main/.extra'},
  yurikey:{r:'YurikeyDev/yurikey',p:'key',n:'yurikey.xml',l:'Yurikey',
    u:'https://raw.githubusercontent.com/YurikeyDev/yurikey/refs/heads/main/key'},
  integrity:{r:'MeowDump/MeowDump',p:'NullVoid/ShockWave.tar',n:'integritybox.xml',l:'Integrity Box',
    u:'https://raw.githubusercontent.com/MeowDump/MeowDump/refs/heads/main/NullVoid/ShockWave.tar'}
};

const getGit=async(r,p)=>{
  try{
    const res=await fetch(`https://api.github.com/repos/${r}/commits?path=${p}&per_page=1`);
    if(!res.ok)return{err:res.headers.get('x-ratelimit-remaining')==='0'?'Rate limited':'GitHub '+res.status};
    const d=new Date((await res.json())[0].commit.committer.date);
    return{date:d,txt:ago(Date.now()-d)};
  }catch{return{err:'Unavailable'}}
};

document.addEventListener('click',async e=>{
  const a=e.target.dataset.action;if(!a)return;
  ui(1,0,0);
  try{
    if(a==='verify'){
      const r=(await Promise.all(Object.values(files).map(
        f=>getGit(f.r,f.p).then(g=>({...g,l:f.l}))
      ))).sort((a,b)=>(b.date||0)-(a.date||0));
      info.innerHTML=r.map(c=>`‚Ä¢ <strong>${c.l}</strong>: ${c.txt||c.err}`).join('<br>');
      ui(0,0,1);
    }else{
      const f=files[a],[raw,git]=await Promise.all([
        fetch(f.u).then(r=>r.text()),getGit(f.r,f.p)
      ]);
      dl.href&&URL.revokeObjectURL(dl.href);
      dl.href=URL.createObjectURL(new Blob([decoders[a](raw)],{type:'application/xml'}));
      dl.download=f.n;dl.textContent=`Download ${f.n}`;
      info.innerHTML=`<strong>${f.l}</strong> updated: ${git.txt||git.err}`;
      ui(0,1,1);
    }
  }catch(err){
    info.textContent='üö® '+err.message;ui(0,0,1,1);
  }
});
</script>
</body>
</html>
